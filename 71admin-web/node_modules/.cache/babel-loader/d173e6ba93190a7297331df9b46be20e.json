{"remainingRequest":"D:\\myworkspce\\myproject\\71\\71admin-web\\node_modules\\babel-loader\\lib\\index.js!D:\\myworkspce\\myproject\\71\\71admin-web\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\myworkspce\\myproject\\71\\71admin-web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\myworkspce\\myproject\\71\\71admin-web\\src\\views\\system\\user\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\myworkspce\\myproject\\71\\71admin-web\\src\\views\\system\\user\\index.vue","mtime":1599936494942},{"path":"D:\\myworkspce\\myproject\\71\\71admin-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\myworkspce\\myproject\\71\\71admin-web\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\myworkspce\\myproject\\71\\71admin-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\myworkspce\\myproject\\71\\71admin-web\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\"use strict\";\n\nvar _interopRequireDefault = require(\"D:/myworkspce/myproject/71/71admin-web/node_modules/@babel/runtime/helpers/interopRequireDefault\");\n\nvar _interopRequireWildcard = require(\"D:/myworkspce/myproject/71/71admin-web/node_modules/@babel/runtime/helpers/interopRequireWildcard\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _defineProperty2 = _interopRequireDefault(require(\"D:/myworkspce/myproject/71/71admin-web/node_modules/@babel/runtime/helpers/defineProperty\"));\n\nvar _typeof2 = _interopRequireDefault(require(\"D:/myworkspce/myproject/71/71admin-web/node_modules/@babel/runtime/helpers/typeof\"));\n\nrequire(\"core-js/modules/es6.regexp.to-string\");\n\nrequire(\"core-js/modules/web.dom.iterable\");\n\nvar _objectSpread2 = _interopRequireDefault(require(\"D:/myworkspce/myproject/71/71admin-web/node_modules/@babel/runtime/helpers/objectSpread2\"));\n\nvar _user = _interopRequireDefault(require(\"@/api/system/user\"));\n\nvar _validate = require(\"@/utils/validate\");\n\nvar _dept = require(\"@/api/system/dept\");\n\nvar _role = require(\"@/api/system/role\");\n\nvar _job = require(\"@/api/system/job\");\n\nvar _crud = _interopRequireWildcard(require(\"@crud/crud\"));\n\nvar _RR = _interopRequireDefault(require(\"@crud/RR.operation\"));\n\nvar _CRUD = _interopRequireDefault(require(\"@crud/CRUD.operation\"));\n\nvar _UD = _interopRequireDefault(require(\"@crud/UD.operation\"));\n\nvar _Pagination = _interopRequireDefault(require(\"@crud/Pagination\"));\n\nvar _DateRangePicker = _interopRequireDefault(require(\"@/components/DateRangePicker\"));\n\nvar _vueTreeselect = _interopRequireWildcard(require(\"@riophae/vue-treeselect\"));\n\nvar _vuex = require(\"vuex\");\n\nrequire(\"@riophae/vue-treeselect/dist/vue-treeselect.css\");\n\nvar _methods;\n\nvar userRoles = [];\nvar userJobs = [];\nvar defaultForm = {\n  id: null,\n  username: null,\n  nickName: null,\n  gender: '男',\n  email: null,\n  enabled: 'false',\n  roles: [],\n  jobs: [],\n  dept: {\n    id: null\n  },\n  phone: null\n};\nvar _default = {\n  name: 'User',\n  components: {\n    Treeselect: _vueTreeselect.default,\n    crudOperation: _CRUD.default,\n    rrOperation: _RR.default,\n    udOperation: _UD.default,\n    pagination: _Pagination.default,\n    DateRangePicker: _DateRangePicker.default\n  },\n  cruds: function cruds() {\n    return (0, _crud.default)({\n      title: '用户',\n      url: 'api/users',\n      crudMethod: (0, _objectSpread2.default)({}, _user.default)\n    });\n  },\n  mixins: [(0, _crud.presenter)(), (0, _crud.header)(), (0, _crud.form)(defaultForm), (0, _crud.crud)()],\n  // 数据字典\n  dicts: ['user_status'],\n  data: function data() {\n    // 自定义验证\n    var validPhone = function validPhone(rule, value, callback) {\n      if (!value) {\n        callback(new Error('请输入电话号码'));\n      } else if (!(0, _validate.isvalidPhone)(value)) {\n        callback(new Error('请输入正确的11位手机号码'));\n      } else {\n        callback();\n      }\n    };\n\n    return {\n      height: document.documentElement.clientHeight - 180 + 'px;',\n      deptName: '',\n      depts: [],\n      deptDatas: [],\n      jobs: [],\n      level: 3,\n      roles: [],\n      jobDatas: [],\n      roleDatas: [],\n      // 多选时使用\n      defaultProps: {\n        children: 'children',\n        label: 'name',\n        isLeaf: 'leaf'\n      },\n      permission: {\n        add: ['admin', 'user:add'],\n        edit: ['admin', 'user:edit'],\n        del: ['admin', 'user:del']\n      },\n      enabledTypeOptions: [{\n        key: 'true',\n        display_name: '激活'\n      }, {\n        key: 'false',\n        display_name: '锁定'\n      }],\n      rules: {\n        username: [{\n          required: true,\n          message: '请输入用户名',\n          trigger: 'blur'\n        }, {\n          min: 2,\n          max: 20,\n          message: '长度在 2 到 20 个字符',\n          trigger: 'blur'\n        }],\n        nickName: [{\n          required: true,\n          message: '请输入用户昵称',\n          trigger: 'blur'\n        }, {\n          min: 2,\n          max: 20,\n          message: '长度在 2 到 20 个字符',\n          trigger: 'blur'\n        }],\n        email: [{\n          required: true,\n          message: '请输入邮箱地址',\n          trigger: 'blur'\n        }, {\n          type: 'email',\n          message: '请输入正确的邮箱地址',\n          trigger: 'blur'\n        }],\n        phone: [{\n          required: true,\n          trigger: 'blur',\n          validator: validPhone\n        }]\n      }\n    };\n  },\n  computed: (0, _objectSpread2.default)({}, (0, _vuex.mapGetters)(['user'])),\n  created: function created() {\n    this.crud.msg.add = '新增成功，默认密码：123456';\n  },\n  mounted: function mounted() {\n    var that = this;\n\n    window.onresize = function temp() {\n      that.height = document.documentElement.clientHeight - 180 + 'px;';\n    };\n  },\n  methods: (_methods = {\n    changeRole: function changeRole(value) {\n      userRoles = [];\n      value.forEach(function (data, index) {\n        var role = {\n          id: data\n        };\n        userRoles.push(role);\n      });\n    },\n    changeJob: function changeJob(value) {\n      userJobs = [];\n      value.forEach(function (data, index) {\n        var job = {\n          id: data\n        };\n        userJobs.push(job);\n      });\n    },\n    deleteTag: function deleteTag(value) {\n      userRoles.forEach(function (data, index) {\n        if (data.id === value) {\n          userRoles.splice(index, value);\n        }\n      });\n    }\n  }, (0, _defineProperty2.default)(_methods, _crud.default.HOOK.afterToCU, function (crud, form) {\n    this.getRoles();\n\n    if (form.id == null) {\n      this.getDepts();\n    } else {\n      this.getSupDepts(form.dept.id);\n    }\n\n    this.getRoleLevel();\n    this.getJobs();\n    form.enabled = form.enabled.toString();\n  }), (0, _defineProperty2.default)(_methods, _crud.default.HOOK.beforeToAdd, function () {\n    this.jobDatas = [];\n    this.roleDatas = [];\n  }), (0, _defineProperty2.default)(_methods, _crud.default.HOOK.beforeToEdit, function (crud, form) {\n    this.getJobs(this.form.dept.id);\n    this.jobDatas = [];\n    this.roleDatas = [];\n    userRoles = [];\n    userJobs = [];\n\n    var _this = this;\n\n    form.roles.forEach(function (role, index) {\n      _this.roleDatas.push(role.id);\n\n      var rol = {\n        id: role.id\n      };\n      userRoles.push(rol);\n    });\n    form.jobs.forEach(function (job, index) {\n      _this.jobDatas.push(job.id);\n\n      var data = {\n        id: job.id\n      };\n      userJobs.push(data);\n    });\n  }), (0, _defineProperty2.default)(_methods, _crud.default.HOOK.afterValidateCU, function (crud) {\n    if (!crud.form.dept.id) {\n      this.$message({\n        message: '部门不能为空',\n        type: 'warning'\n      });\n      return false;\n    } else if (this.jobDatas.length === 0) {\n      this.$message({\n        message: '岗位不能为空',\n        type: 'warning'\n      });\n      return false;\n    } else if (this.roleDatas.length === 0) {\n      this.$message({\n        message: '角色不能为空',\n        type: 'warning'\n      });\n      return false;\n    }\n\n    crud.form.roles = userRoles;\n    crud.form.jobs = userJobs;\n    return true;\n  }), (0, _defineProperty2.default)(_methods, \"getDeptDatas\", function getDeptDatas(node, resolve) {\n    var _this2 = this;\n\n    var sort = 'id,desc';\n    var params = {\n      sort: sort\n    };\n\n    if ((0, _typeof2.default)(node) !== 'object') {\n      if (node) {\n        params['name'] = node;\n      }\n    } else if (node.level !== 0) {\n      params['pid'] = node.data.id;\n    }\n\n    setTimeout(function () {\n      (0, _dept.getDepts)(params).then(function (res) {\n        if (resolve) {\n          resolve(res.content);\n        } else {\n          _this2.deptDatas = res.content;\n        }\n      });\n    }, 100);\n  }), (0, _defineProperty2.default)(_methods, \"getDepts\", function getDepts() {\n    var _this3 = this;\n\n    (0, _dept.getDepts)({\n      enabled: true\n    }).then(function (res) {\n      _this3.depts = res.content.map(function (obj) {\n        if (obj.hasChildren) {\n          obj.children = null;\n        }\n\n        return obj;\n      });\n    });\n  }), (0, _defineProperty2.default)(_methods, \"getSupDepts\", function getSupDepts(deptId) {\n    var _this4 = this;\n\n    (0, _dept.getDeptSuperior)(deptId).then(function (res) {\n      var date = res.content;\n\n      _this4.buildDepts(date);\n\n      _this4.depts = date;\n    });\n  }), (0, _defineProperty2.default)(_methods, \"buildDepts\", function buildDepts(depts) {\n    var _this5 = this;\n\n    depts.forEach(function (data) {\n      if (data.children) {\n        _this5.buildDepts(data.children);\n      }\n\n      if (data.hasChildren && !data.children) {\n        data.children = null;\n      }\n    });\n  }), (0, _defineProperty2.default)(_methods, \"loadDepts\", function loadDepts(_ref) {\n    var action = _ref.action,\n        parentNode = _ref.parentNode,\n        callback = _ref.callback;\n\n    if (action === _vueTreeselect.LOAD_CHILDREN_OPTIONS) {\n      (0, _dept.getDepts)({\n        enabled: true,\n        pid: parentNode.id\n      }).then(function (res) {\n        parentNode.children = res.content.map(function (obj) {\n          if (obj.hasChildren) {\n            obj.children = null;\n          }\n\n          return obj;\n        });\n        setTimeout(function () {\n          callback();\n        }, 200);\n      });\n    }\n  }), (0, _defineProperty2.default)(_methods, \"handleNodeClick\", function handleNodeClick(data) {\n    if (data.pid === 0) {\n      this.query.deptId = null;\n    } else {\n      this.query.deptId = data.id;\n    }\n\n    this.crud.toQuery();\n  }), (0, _defineProperty2.default)(_methods, \"changeEnabled\", function changeEnabled(data, val) {\n    var _this6 = this;\n\n    this.$confirm('此操作将 \"' + this.dict.label.user_status[val] + '\" ' + data.username + ', 是否继续？', '提示', {\n      confirmButtonText: '确定',\n      cancelButtonText: '取消',\n      type: 'warning'\n    }).then(function () {\n      _user.default.edit(data).then(function (res) {\n        _this6.crud.notify(_this6.dict.label.user_status[val] + '成功', _crud.default.NOTIFICATION_TYPE.SUCCESS);\n      }).catch(function () {\n        data.enabled = !data.enabled;\n      });\n    }).catch(function () {\n      data.enabled = !data.enabled;\n    });\n  }), (0, _defineProperty2.default)(_methods, \"getRoles\", function getRoles() {\n    var _this7 = this;\n\n    (0, _role.getAll)().then(function (res) {\n      _this7.roles = res;\n    }).catch(function () {});\n  }), (0, _defineProperty2.default)(_methods, \"getJobs\", function getJobs() {\n    var _this8 = this;\n\n    (0, _job.getAllJob)().then(function (res) {\n      _this8.jobs = res.content;\n    }).catch(function () {});\n  }), (0, _defineProperty2.default)(_methods, \"getRoleLevel\", function getRoleLevel() {\n    var _this9 = this;\n\n    (0, _role.getLevel)().then(function (res) {\n      _this9.level = res.level;\n    }).catch(function () {});\n  }), (0, _defineProperty2.default)(_methods, \"checkboxT\", function checkboxT(row, rowIndex) {\n    return row.id !== this.user.id;\n  }), _methods)\n};\nexports.default = _default;",null]}